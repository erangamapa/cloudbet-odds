# Cloudbet API Market Helper

## Install

```
npm install @cloudbet/market-helper
```

or

```
yarn add @cloudbet/market-helper
```

## Getting Started with the Cloudbet API Market Helper

There are a few things to note when using the Cloudbet Odds Feed API. To reduce the payload size of each API response, certain static market information has been stripped from the data. To make full sense of each market you can use the `Cloudbet API Market Helper`. It will help you to:

- Distinguish lines
- Recognize handicap and totals values
- Create human readable market and outcome names
- Distinguish between back and lay side (upcoming feature)
- Access odds for a specific market

### Fetching and getting a market from an event

`getMarket` Returns a list of markets for a specific `MarketType`. The different markets of the same type are usually divided by the time period for which they are relevant. E.g. for soccer, it might return 3 markets for fulltime, first half, and second half.

```js

import { getMarket } from '@cloudbet/market-helper';

function async getMarkets(eventId, marketType){

    const event = await fetch(`https://sports-api.cloudbet.com/pub/v2/odds/events/${eventId}`, {
        method: 'GET',
        headers: {
            // e.g eyJhbGciOiJSUzI1NiIsImtpZCI6ImxPVGE3LXV...
            'X-API-KEY': CLOUDBET_API_KEY
        }
    }).then(response => response.json());

    const [markets, err] = getMarket(event, marketType);
    if(err){
        throw new Error(err)
    }
    return markets;
}
```

### Accessing outcomes by line

Each market consists of one or more lines. Or 0 lines, if the market is currently not active. <!-- not sure if that is the actual behavior of the sdk -->

Lines are sorted by tightness. That means the first line has the smallest difference between the outcome prices.

Each line is an array of outcome objects.

```js
import { MarketTypes} from '@cloudbet/market-helper'

function async getSoccerMatchOddsForEvent(eventId){
    const markets = await getMarkets(eventId, MarketType.soccer_match_odds);
    return markets.map(market => {
        // the translated market name
        const marketName = market.name;
        // the lines for the given market, an array of outcomes
        const lines = market.lines;

        lines.map(outcomes => {
            outcomes.map(outcome => {
                // Translated name of the outcome
                const outcomeName = outcome.name;
                // the back selection for that particular outcome
                const backSelection = outcome.back;
                // price of the selection
                const price = backSelection.price;

                // variables, such as handicap or over/under value
                const variables = backSelection.variables;
            })
        })
    });
}

```

### Accesing handicap value for an outcome

```js
function getHandicapValue(outcome) {
	const handicap = outcome.variables.handicap
	return handicap
}
```

### Accessing over under value for an outcome

```js
function getOverUnderValue(outcome) {
	const total = outcome.variable.total
	return total
}
```
